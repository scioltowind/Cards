<%
/* global vcard */
const DEFAULT_LINK = 'https://www.nantou.gov.tw'
function gaScreenView (vcard) {
  const TEMPLATE_NAME = '個人數位名片-2023/07/22'
  let hash = CryptoJS.HmacMD5(JSON.stringify(vcard), TEMPLATE_NAME)
  hash = CryptoJS.enc.Base64.stringify(hash).replace(/[+/=]/g, c => _.get({ '+': '-', '/': '_', '=': '' }, c))
  return gtag.mpCollectUrl({
    client_id: gtagClientId,
    events: [{
      name: 'template_impression',
      params: {
        session_id: gtagSessionId,
        share_by: profile.userId ?? 'unknown',
        template_name: TEMPLATE_NAME,
        vcard_hash: hash,
        vcard_name: vcard.name,
      },
    }],
  })
}

function renderCard(ctx) {
  const uri = DEFAULT_LINK
  return {
     type: 'bubble',
     altText: '這是蔡承靜的電子名片，名片上有連結可以開啟。',
     size: 'mega',
     body:{
        type: 'box',
        layout: 'vertical',
        contents: [
        {
          type: 'box',
          layout: 'vertical',
          contents: [
          {
            type: 'image',
            url: 'https://hackmd.io/_uploads/r1jaLSKq3.png',
            size: 'full',
            aspectMode: 'fit',
            aspectRatio: '100:20',
            grayity: 'top',
            margin: 'none',
            animated: true,
            action:{
              type: 'uri',
              label: 'action',
              uri: 'https://www.vac.gov.tw/mp-110.html'
            }
          }]
        }]
       },
      {
        type: 'box',
        layout: 'vertical',
        contents:[
        {
          type: 'box',
          layout: 'horizontal',
          contents: [
          {
            type: 'text',
            text: '蔡承靜',
            size: 'xxl',
            weight: 'bold',
            align: 'center'
          },
          {
            type: 'text',
            text: '就業輔導員',
            position: 'relative',
            align: 'start',
            gravity: 'bottom'
          }
          ]
         },
         {
          type: 'text',
          text: '電話：049-2222036#48',
          action: {
              type: 'uri',
              label: 'action',
              uri: 'tel:049-2222036,48'
          }
         },
        {
           type: 'text',
           text: 'FAX：049-2238200'          
         },
        {
           type: 'text',
           text: '地址：南投市民族路505號',
           action: {
              type: 'uri',
              label: 'action',
              uri: 'https://goo.gl/maps/urUPewuf4DuwTRKP6'
            }
          },
          {
            type: 'text',
            text: 'E-Mail：n222036@gmail.com',
            action: {
              type: 'uri',
              label: 'action',
              uri: 'mailto:n222036@gmail.com'
            }
          }
        ]
   }     
}


function renderCarousel (ctx) {
  const { vcard } = ctx
  return {
    type: 'flex',
    altText: vcard.altText,
    contents: {
      type: 'carousel',
      contents: _.map(vcard.cards, (card, cardIdx) => renderCard({ ...ctx, card, cardIdx })),
    },
  }
}
print(JSON.stringify(renderCard({ vcard })))
%>
